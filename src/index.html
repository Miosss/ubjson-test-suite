<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>UBJSON test page</title>
        <style type="text/css">
            textarea { border:1px solid #999999; font-family: monospace; }
            .result { background-color: #F0F0F0; }
        </style>
        <script type="text/javascript" src="ubjson-test-suite-core.js"></script>
    </head>
    <body>
        <div>
            <textarea id="txt-input">{"answer": 42}</textarea>
        </div>
        <div class="result">
            <pre id="disp">?</pre>
        </div>
        <a id="link-binary" download="demo.ubj" href="data:application/ubjson;base64,">Download binary</a>
        <script type="text/javascript">
            var inpValue = null;
            var onTextChange = function(){
                var val = document.getElementById('txt-input').value;
                if (inpValue !== val) {
                    inpValue = val;
                    updateData(val);
                }
            }
            window.onload = onTextChange;
            function updateData(jsonText)
            {
                var parseResult = {};
                try {
                    var value = JSON.parse(jsonText);
                    parseResult.items = UbjsonTestSuiteCore.serialize(value);
                    parseResult.success = true;
                } catch(error) {
                    parseResult.success = false;
                    parseResult.error = error;
                }

                if (parseResult.success) {
                    var text = UbjsonTestSuiteCore.render(parseResult.items);
                    document.getElementById('disp').innerHTML = text;
                } else {
                    //document.getElementById('disp').innerHTML = parseResult.error;
                }
            }

            var inp = document.getElementById('txt-input');
            inp.onkeyup = onTextChange;
            inp.onchange = onTextChange;
            inp.onpaste = function(){
                setTimeout(function(){
                    onTextChange();
                }, 0);
            }
        </script>
    </body>
</html>