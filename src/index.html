<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>UBJSON test page</title>
        <style type="text/css">
            textarea { border:1px solid #999999; font-family: monospace; }
            .result { background-color: #F0F0F0; }
            .obj { color: #009900; }
            .key { color: #0000FF; }
            .ival { color: #FF0000; }
            .sval { color: #DF00DF; }
        </style>
        <script type="text/javascript" src="block-notation.js"></script>
    </head>
    <body>
        <div>
            <textarea id="txt-input">{"answer": 42}</textarea>
        </div>
        <div class="result">
            <pre id="disp">?</pre>
        </div>
        <a id="link-binary" download="demo.ubj" href="data:application/ubjson;base64,">Download binary</a>
        <script type="text/javascript">
            var inpValue = null;

            // var hello = "привет";
            // var utf8 = unescape(encodeURIComponent(hello));
            // document.getElementById('link-binary').innerHTML = 'UTF-8 size: ' + utf8.length;
            // document.getElementById('disp').innerHTML = str;

            window.onload = function(){
                var str = '<span class="obj">[{]</span>\n' + '    ' +
                    '<span class="key">[i][6][answer]</span><span class="ival">[i][42]</span>\n' +
                    '<span class="obj">[}]</span>';
                document.getElementById('disp').innerHTML = str;
            }
            var onTextChange = function(){
                var val = document.getElementById('txt-input').value;
                if (inpValue !== val) {
                    inpValue = val;
                    updateData(val);
                }
            }
            function updateData(jsonText)
            {
                var data = {};
                try {
                    data.value = JSON.parse(jsonText);
                    data.success = true;
                } catch(error) {
                    data.success = false;
                    data.error = error;
                }

                if (data.success) {
                    var block = BlockNotation.create(data.value);
                    document.getElementById('disp').innerHTML = 'OK! (' + block.value + ')';
                } else {
                    document.getElementById('disp').innerHTML = 'ERR: ' + data.error;
                }
            }

            var inp = document.getElementById('txt-input');
            inp.onkeyup = onTextChange;
            inp.onchange = onTextChange;
            inp.onpaste = function(){
                setTimeout(function(){
                    onTextChange();
                }, 0);
            }
        </script>
    </body>
</html>